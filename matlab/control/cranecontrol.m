%==============================================================================
% AAUCrane Control
%==============================================================================
% Load models (Mx, My, X, Y, W)
run('../model/cranemodel.m');

%------------------------------------------------------------------------------
% X'(s) Control
%------------------------------------------------------------------------------
% rlocus(Mx) => 10 ?
C1 = 50;
loop1 = feedback(C1*Mx, 1);

%------------------------------------------------------------------------------
% X(s) Control
%------------------------------------------------------------------------------
% Close the loop

% rlocus(loop1 * gear * 1/s) => 10 < Gain
% rlocus(X) => 10 < Gain
C2 = 11.6;
loop2 = feedback(C2 *  Mx * gear * (1/s), 1);


%------------------------------------------------------------------------------
% W(s) Control
%------------------------------------------------------------------------------
% rlocus(-loop2*W) 
% Gain can be between (19.7 <= Gain <= 45.8)
%C3 = 45.8;
%------------------------------------------------------------------------------
% PID Control
%------------------------------------------------------------------------------
% PID = k * ( 1 + 1/(Ti*s) + Td*s );
%
Tp = 1;     %from formular
Td = 0.06;  %step(loop2*4) time below 0.01 amplitude
Ti = 4;     %bode(loop2*-W) Ti = freq. at -45degrees
k = 40;     %Trail and error

%------------------------------------------------------------------------------
% Y(s) Control
%------------------------------------------------------------------------------
% rlocus(Y) => No overshoot + Max gain => 49.3
C4 = 49.3;

% Y*(1 - z^(-1)) = X * (1.002 - 0.9982 * z^(-1))
% y = 1.002 x[n] - 0.9982 x[n-1] + y[n-1]
